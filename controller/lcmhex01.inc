; $Id: lcmhex01.inc,v 1.1 2005/07/29 14:58:52 tgipson Exp $
str_hex_ver:
	DW	"$Id: lcmhex01.inc,v 1.1 2005/07/29 14:58:52 tgipson Exp $\r\n\x00"


; copied to lcmhex01.h for pic18f6620
; 2004/01/26 by Tim Gipson for LCMEM::SDR
; bank switching removed

; imhex01.h for pic16f874
; 11/02/2001 Gert Muller for IMEMS
; no change

; sdhex01.h for pic16f873
; 5/4/2001 Gert Muller for SDBS

; h01hex.h for pic17c
; recieving values in ASCII as two characters and convert to one byte  10/17/2000 - Gert Muller
; sending values in wreg as two hexadecimal digits  7/31/2000 - Gert Muller

SENDHEX:
	;BCF	STATUS, RP0
	MOVWF	HEXTEMP
	MOVLW	B'11110000'
	ANDWF	HEXTEMP,W
	MOVWF	HEXTEMP1
	SWAPF	HEXTEMP1,W
	CALL	SENDNIB

	MOVLW	B'00001111'
	ANDWF	HEXTEMP,W
	CALL	SENDNIB

	RETURN

;------------------------------------------------------------------

SENDNIB:
	MOVWF	HEXTEMP1
	SUBLW	H'09'
	BTFSC	STATUS,C
	GOTO	SENDHEXNUM
	GOTO	SENDHEXALPHA
SENDHEXALPHA:
	MOVLW	H'37'
	ADDWF	HEXTEMP1,W	
	CALL	SENDCMNDP2
	RETURN
SENDHEXNUM:
	MOVLW	H'30'
	ADDWF	HEXTEMP1,W	
	CALL	SENDCMNDP2
	RETURN

;-----------------------------------------------------------------

ASCII2HEX:			; converts SERR01 and SERR02 to HEXCONV
	;BCF	STATUS,RP0	; bank 0
	MOVF	SERR01,W
	MOVWF	HEXCONV
	SUBLW	H'40'
	BTFSC	STATUS,C
	GOTO	ASCDIGIT1
	GOTO	ASCALPHA1
ASCALPHA1:
	MOVLW	H'37'
	SUBWF	HEXCONV,F
	SWAPF	HEXCONV,F
	GOTO	NEXTNIB
ASCDIGIT1:
	MOVLW	H'30'
	SUBWF	HEXCONV,F
	SWAPF	HEXCONV,F
	GOTO	NEXTNIB
NEXTNIB:
	MOVF	HEXCONV,W
;	CALL	SENDHEX
	MOVLW	H'00'
;	CALL	SENDHEX

	;BCF	STATUS, RP0
	MOVF	SERR02,W
	MOVWF	HEXCONV1
	SUBLW	H'40'
	BTFSC	STATUS,W
	GOTO	ASCDIGIT2
	GOTO	ASCALPHA2	
ASCALPHA2:
	MOVLW	H'37'
	SUBWF	HEXCONV1,F
	MOVF	HEXCONV1,W
	ADDWF	HEXCONV,F
	GOTO	DONENIB
ASCDIGIT2:
	MOVLW	H'30'
	SUBWF	HEXCONV1,F
	MOVF	HEXCONV1,W
	ADDWF	HEXCONV,F
	GOTO	DONENIB
DONENIB:
	MOVF	HEXCONV1,W
;
	CALL	SENDHEX
	;BCF 	STATUS,RP0	; BANK 0
	MOVF	HEXCONV,W
	RETURN

